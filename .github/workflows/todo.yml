name: Sync Todo.md with Issues

on:
    schedule:
        - cron: "0 12 * * *"
    workflow_dispatch:

jobs:
    sync_todo:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4

            - name: Generate Todo.md
              run: |
                  echo "# TODO" > Todo.md
                  echo "" >> Todo.md
                  echo "## 🔙 Backend" >> Todo.md
                  gh issue list --label "backend" --state open --json number,title,createdAt \
                    --jq '.[] | "- [ ] \(.title) (#\(.number)) — created: \(.createdAt[:10])"' >> Todo.md
                  echo "" >> Todo.md
                  echo "## 🖼️ Frontend" >> Todo.md
                  gh issue list --label "frontend" --state open --json number,title,createdAt \
                    --jq '.[] | "- [ ] \(.title) (#\(.number)) — created: \(.createdAt[:10])"' >> Todo.md
                  echo "" >> Todo.md
                  echo "## ✔️ Completed" >> Todo.md
                  gh issue list --state closed --json number,title,closedAt \
                    --jq '.[] | "- [x] \(.title) (#\(.number)) — completed: \(.closedAt[:10])"' >> Todo.md

            - name: Commit updated Todo.md
              run: |
                  git config user.name "github-actions"
                  git config user.email "github-actions@github.com"
                  git add Todo.md
                  git commit -m "docs(todo): sync with GitHub issues" || echo "No changes"
                  git push
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
